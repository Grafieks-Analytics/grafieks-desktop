<!DOCTYPE html>

<head>
	<meta charset="utf-8" />

	<!-- Load d3.js -->
	<script src="./Data/d3.v4.min.js"></script>

	<!-- Color scale -->
	<script src="Data/d3-scale-chromatic.v1.min.js"></script>
	<link rel="icon" href="logo.png" type="image/png" sizes="32x32" />
	<link rel="stylesheet" href="Data/general.css" />

	<title>Pie Chart</title>
</head>
<body>
	<!-- Add 2 buttons -->
	<button onclick="update(data1)">Data 1</button>
	<button onclick="update(data2)">Data 2</button>

	<!-- Create a div where the graph will take place -->
	<div id="my_dataviz"></div>
	<div id="tooltip"></div>

	<script>
		// Color Pallets - Set 3
		const d3colors = [
			"#8DD3C9",
			"#FFFFAA",
			"#B8BED6",
			"#F98171",
			"#78B5D1",
			"#FFB15B",
			"#B4E061",
			"#FDCDE5",
			"#DAD9D4",
			"#BD7FBE",
			"#CDE9C1",
			"#FFEA77"
		];

		// set the dimensions and margins of the graph
		var width = 600;
		height = 600;
		margin = 40;

		// The radius of the pieplot is half the width or half the height (smallest one). I subtract a bit of margin.
		var radius = Math.min(width, height) / 2 - margin;

		// append the svg object to the div called 'my_dataviz'
		var svg = d3
			.select("#my_dataviz")
			.append("svg")
			.attr("width", width)
			.attr("height", height)
			.append("g")
			.attr(
				"transform",
				"translate(" + width / 2 + "," + height / 2 + ")"
			);

		// create 2 data_set
		var data1 = { a: 9, b: 20, c: 30, d: 8, e: 12 };
		var data2 = { a: 6, b: 16, c: 20, d: 14, e: 19, f: 12 };

		// set the color scale
		var color = d3
			.scaleOrdinal()
			.domain(["a", "b", "c", "d", "e", "f"])
			.range(d3.schemeSet3);

		// A function that create / update the plot for a given variable:
		function update(data) {
			// Compute the position of each group on the pie:
			var pie = d3
				.pie()
				.value(function(d) {
					return d.value;
				})
				.sort(function(a, b) {
					return d3.ascending(a.key, b.key);
				}); // This make sure that group order remains the same in the pie chart

			var data_ready = pie(d3.entries(data));

			// map to data
			var u = svg.selectAll("path").data(data_ready);

			// Build the pie chart: Basically, each part of the pie is a path that we build using the arc function.
			u.enter()
				.append("path")
				.merge(u)
				// .transition()
				// .duration(1000)
				.attr("id", "new_path")
				.attr(
					"d",
					d3
						.arc()
						.innerRadius(0)
						.outerRadius(radius)
				)
				.attr("fill", function(d) {
					return color(d.data.key);
				})
				.attr("class", function(d, i) {
					return "pie";
				})
				.attr("stroke", "white")
				.style("stroke-width", "2px")
				.style("opacity", 1)
				.on("mouseover mousemove", function(d, i) {
					var x_pos = d3.mouse(this)[0] + margin + radius;
					var y_pos = d3.mouse(this)[1] + radius + margin;

					d3.select("#tooltip")
						.style("left", x_pos + "px")
						.style("top", y_pos + "px")
						.style("display", "block")
						.text(d.data.key);

					d3.selectAll(".pie").style("opacity", 0.3);
					d3.select(this).style("opacity", 1);
				})

				.on("mouseout", function(d, i) {
					d3.select("#tooltip").style("display", "none");

					d3.selectAll(".pie").style("opacity", 1);
				});

			// remove the group that is not present anymore
			u.exit().remove();
		}

		// Initialize the plot with the first dataset
		update(data1);
	</script>
</body>
