<!DOCTYPE html>

<head>
    <meta charset="utf-8" />

    <!-- Load d3.js -->
    <script src="./Data/d3.v4.min.js"></script>

    <!-- Color scale -->
    <script src="./Data/d3DefaultConfig.js"></script>

    <script src="Data/d3-scale-chromatic.v1.min.js"></script>
    <link rel="stylesheet" href="Data/general.css" />

    <title>Pie Chart</title>
</head>
<body>
    <!-- Create a div where the graph will take place -->
    <div id="my_dataviz"></div>
    <div id="tooltip"></div>

    <script>
        // create 2 data_set
        var data = { a: 9, b: 20, c: 30, d: 8, e: 12, g: 45 };

        function drawChart(data, plottingConfiguration = {}) {
            let {
                d3colorPalette,
                paddingInner,
                legendConfig,
            } = plottingConfiguration;
            if (!d3colorPalette) {
                d3colorPalette = defaultD3Config.d3ColorPalette;
            }
            const d3Colors = d3[d3colorPalette];
            // set the dimensions and margins of the graph
            var margin = { top: 30, right: 30, bottom: 70, left: 60 },
                width = window.innerWidth - margin.left - margin.right - 20,
                height = window.innerHeight - margin.top - margin.bottom - 20;

            // The radius of the pieplot is half the width or half the height (smallest one). I subtract a bit of margin.
            var radius = Math.min(width, height) / 2;

            d3.selectAll("#my_dataviz").html("");
            // append the svg object to the div called 'my_dataviz'
            var svg = d3
                .select("#my_dataviz")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr(
                    "transform",
                    "translate(" + width / 2 + "," + height / 2 + ")"
                );

            // set the color scale
            var color = d3
                .scaleOrdinal()
                .domain(Object.keys(data))
                .range(d3Colors);

            // Compute the position of each group on the pie:
            var pie = d3
                .pie()
                .value(function (d) {
                    return d.value;
                })
                .sort(function (a, b) {
                    return d3.ascending(a.key, b.key);
                }); // This make sure that group order remains the same in the pie chart

            var data_ready = pie(d3.entries(data));

            // map to data
            var u = svg.selectAll("path").data(data_ready);

            // Build the pie chart: Basically, each part of the pie is a path that we build using the arc function.
            u.enter()
                .append("path")
                .merge(u)
                // .transition()
                // .duration(1000)
                .attr("id", "new_path")
                .attr("d", d3.arc().innerRadius(0).outerRadius(radius))
                .attr("fill", function (d) {
                    return color(d.data.key);
                })
                .attr("class", function (d, i) {
                    return "pie";
                })
                .attr("stroke", "white")
                .style("stroke-width", "2px")
                .style("opacity", 1)
                .on("mouseover mousemove", function (d, i) {
                    var x_pos = d3.mouse(this)[0] + width / 2;
                    var y_pos = d3.mouse(this)[1] + height / 2;

                    d3.select("#tooltip")
                        .style("left", x_pos + "px")
                        .style("top", y_pos + "px")
                        .style("display", "block")
                        .text(d.data.key);

                    d3.selectAll(".pie").style("opacity", 0.3);
                    d3.select(this).style("opacity", 1);
                })

                .on("mouseout", function (d, i) {
                    d3.select("#tooltip").style("display", "none");

                    d3.selectAll(".pie").style("opacity", 1);
                });

            // remove the group that is not present anymore
            u.exit().remove();
        }

        // Initialize the plot with the first dataset
        drawChart(data);
    </script>
</body>
