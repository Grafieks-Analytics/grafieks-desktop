<html>
    <head>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <link href="./Data/pivot.min.css" rel="stylesheet" />
        <script src="./Data/pivot.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.6.0/tips_data.min.js"></script>
    </head>
    <body>
        <div id="output"></div>
        <script>
            // const aggregatorList = [
            //     "Count",
            //     "Count Unique Values",
            //     "List Unique Values",
            //     "Sum",
            //     "Integer Sum",
            //     "Average",
            //     "Median",
            //     "Sample Variance",
            //     "Sample Standard Deviation",
            //     "Minimum",
            //     "Maximum",
            //     "First",
            //     "Last",
            //     "Sum over Sum",
            //     "80% Upper Bound",
            //     "80% Lower Bound",
            //     "Sum as Fraction of Total",
            //     "Sum as Fraction of Rows",
            //     "Sum as Fraction of Columns",
            //     "Count as Fraction of Total",
            //     "Count as Fraction of Rows",
            //     "Count as Fraction of Columns",
            // ];

            const data = [
                [
                    [
                        "row",
                        "total_bill",
                        "tip",
                        "sex",
                        "smoker",
                        "day",
                        "time",
                        "size",
                        "Quantity",
                        "Sales",
                        "Sum of Quantity",
                        "Sum of Sales",
                    ],
                    ["1", 16.99, 1.01, "Female", "No", "Mon", "Dinner", 2],
                    ["2", 10.34, 1.66, "Male", "No", "Mon", "Dinner", 3],
                    ["3", 21.01, 3.5, "Male", "No", "Sun", "Dinner", 3],
                    ["4", 23.68, 3.31, "Male", "No", "Tue", "Lunch", 2],
                    ["4", 23.68, 3.31, "Female", "No", "Tue", "Lunch", 2],
                    ["5", 24.59, 3.61, "Female", "No", "Sun", "Dinner", 4],
                    ["6", 25.29, 4.71, "Male", "No", "Wed", "Dinner", 4],
                    ["6", 25.29, 4.71, "Female", "No", "Wed", "Dinner", 4],
                    ["7", 8.77, 2, "Male", "No", "Sun", "Dinner", 2],
                    ["8", 26.88, 3.12, "Male", "No", "Sun", "Dinner", 4],
                    ["9", 15.04, 1.96, "Male", "No", "Sun", "Dinner", 2],
                    ["10", 14.78, 3.23, "Male", "No", "Sun", "Lunch", 2],
                    ["9", 15.04, 1.96, "Male", "No", "Sun", "Lunch", 2],
                    ["10", 14.78, 3.23, "Male", "Yes", "Sun", "Lunch", 2],
                    ["9", 15.04, 1.96, "Male", "No", "Sun", "Dinner", 2],
                    ["10", 14.78, 3.23, "Male", "Yes", "Sun", "Dinner", 2],
                    ["9", 15.04, 1.96, "Male", "Yes", "Sun", "Dinner", 2],
                    ["10", 14.78, 3.23, "Male", "Yes", "Sun", "Dinner", 2],
                ],
                ["smoker", "day"],
                ["day", "time", "sex"],
                ["total_bill", "tip"],
            ];

            function drawChart(data, plottingConfiguration = {}) {
                var [dataValues, rows, cols, aggregatorData] = data;
                var utils = $.pivotUtilities;
                var heatmap = utils.renderers["heatmap"];

                let { aggregator } = plottingConfiguration;
                if (!aggregator) {
                    aggregator = "Sum";
                }

                aggregatorsFunction =
                    aggregator && utils.aggregators[aggregator];

                $("#output").pivot(dataValues, {
                    rows,
                    cols,
                    aggregator:
                        aggregatorsFunction &&
                        aggregatorsFunction(aggregatorData),
                    renderer: heatmap,
                });
            }

            function leftTotal() {
                const firstRow = $("tr:first-child th.pvtColLabel");
                var totalColumns = 0;
                for (var i = 0; i < firstRow.length; i++) {
                    var cell = firstRow[i];
                    var colspanAttritubeValue = cell.colSpan || 0;
                    if (
                        !colspanAttritubeValue ||
                        colspanAttritubeValue == "undefined"
                    ) {
                        continue;
                    }
                    totalColumns += colspanAttritubeValue;
                }

                var trsBefore = $("td[data-value]");
                for (
                    var i = totalColumns;
                    i < trsBefore.length;
                    i += totalColumns + 1
                ) {
                    $(trsBefore.get(i - totalColumns)).before(trsBefore.get(i));
                }

                var thBefores = $("tr:first-child .pvtAxisLabel");

                var totalColumn = $(".pvtTotalLabel");
                var column1 = $("th.pvtColLabel");

                $(column1.get(0)).before(totalColumn.get(0));
            }

            function rightTotal() {
                const firstRow = $("tr:first-child th.pvtColLabel");
                var totalColumns = 0;

                for (var i = 0; i < firstRow.length; i++) {
                    var cell = firstRow[i];
                    var colspanAttritubeValue = cell.colSpan || 0;
                    if (
                        !colspanAttritubeValue ||
                        colspanAttritubeValue == "undefined"
                    ) {
                        continue;
                    }
                    totalColumns += colspanAttritubeValue;
                }

                var trsBefore = $("td[data-value]");
                for (
                    var i = totalColumns;
                    i < trsBefore.length;
                    i += totalColumns + 1
                ) {
                    $(trsBefore.get(i)).after(trsBefore.get(i - totalColumns));
                }

                var totalColumn = $(".pvtTotalLabel");
                var column1 = $("tr:first-child th.pvtColLabel");
                console.log(totalColumn);

                $(column1.get(column1.length - 1)).after(totalColumn.get(0));
            }

            drawChart(data);
        </script>
    </body>
</html>
