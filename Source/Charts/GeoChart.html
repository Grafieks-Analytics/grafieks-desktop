<!DOCTYPE html>
<head>
    <meta charset="utf-8" />

    <!-- Load d3.js -->
    <script src="./Data/d3DefaultConfig.js"></script>
    <script src="./Data/geoCoordinates.js"></script>
    <script src="./Data/d3.v4.min.js"></script>
    <script src="Data/d3-scale-chromatic.v1.min.js"></script>
    <script src="Data/d3-geo-projection.v2.min.js"></script>
    <script src="./Data/min/numeral.min.js"></script>
    <link rel="stylesheet" href="Data/general.css" />

    <title>Geo Chart</title>
    <link rel="icon" href="logo.png" type="image/png" sizes="32x32" />
</head>
<body>
    <div style="text-align: center">
        <!-- Create an element where the map will take place -->
        <svg id="my_dataviz"></svg>
    </div>
    <div id="tooltip"></div>

    <script>
        var dataValues = [
            [
                ["ATG", "83039"],
                ["DZA", "32854159"],
                ["AZE", "8352021"],
                ["ALB", "3153731"],
                ["ARM", "3017661"],
                ["AGO", "16095214"],
                ["ASM", "64051"],
                ["ARG", "38747148"],
                ["AUS", "20310208"],
                ["PER", "27274266"],
                ["PAK", "158080591"],
                ["POL", "38195558"],
                ["PAN", "3231502"],
                ["PRT", "10528226"],
                ["PNG", "6069715"],
                ["GNB", "1596929"],
                ["QAT", "796186"],
                ["REU", "785159"],
                ["ROU", "21627557"],
                ["SOM", "8196395"],
                ["ESP", "43397491"],
                ["LCA", "16124"],
                ["SDN", "36899747"],
                ["SWE", "9038049"],
                ["SYR", "18893881"],
                ["CHE", "7424389"],
                ["TTO", "1323722"],
                ["THA", "63002911"],
                ["TJK", "6550213"],
                ["PLW", "20127"],
                ["MHL", "5672"],
                ["SPM", "6346"],
                ["SHN", "6399"],
                ["SMR", "30214"],
                ["TCA", "24459"],
                ["ESH", "440428"],
                ["SRB", "9863026"],
                ["VAT", "783"],
                ["SJM", "0"],
                ["MAF", "0"],
                ["BLM", "0"],
                ["GGY", "0"],
                ["JEY", "0"],
                ["SGS", "0"],
                ["TWN", "0"],
            ],
            ["Population"],
        ];

        function drawChart(chartValues, plottingConfiguration = {}) {
            // Data and color scale
            var data = d3.map();

            var dataValues = chartValues[0];
            var title = dataValues[1];

            let {
                d3colorPalette,
                paddingInner,
                markerShape,
                curveType,
                scaleValue,
            } = plottingConfiguration;
            if (!d3colorPalette) {
                d3colorPalette = defaultD3Config.d3ColorPalette;
            }
            d3Colors = d3colorPalette;

            if (!scaleValue) {
                scaleValue = 100;
            }

            (margin = { top: 30, right: 30, bottom: 70, left: 60 }),
                (width = window.innerWidth - margin.left - margin.right - 20),
                (height = window.innerHeight - margin.top - margin.bottom - 20);

            d3.select("#my_dataviz")
                .attr("width", width)
                .attr("height", height)
                .html("");

            // The svg
            var svg = d3.select("svg");

            // Map and projection
            var path = d3.geoPath();
            var projection = d3
                .geoMercator()
                .scale(scaleValue)
                .center([0, 0])
                .translate([width / 2, height / 2]);

            var colorScale = d3
                .scaleThreshold()
                .domain([
                    100000, 1000000, 10000000, 30000000, 100000000, 500000000,
                ])
                .range(d3Colors);

            for (var i = 0; i < dataValues.length; i++) {
                const [code, value] = dataValues[i];
                data.set(code, +value);
            }

            // Draw the map
            svg.append("g")
                .selectAll("path")
                .data(defaultCountryWiseData.features)
                .enter()
                .append("path")
                // draw each country
                .attr("d", d3.geoPath().projection(projection))
                // set the color of each country
                .attr("fill", function (d) {
                    d.total = data.get(d.id) || 0;
                    return colorScale(d.total);
                })
                .on("mouseover mousemove", function (d, i) {
                    var x_pos = d3.mouse(this)[0];
                    var y_pos = d3.mouse(this)[1];

                    d3.select("#tooltip")
                        .style("left", x_pos + "px")
                        .style("top", y_pos + "px")
                        .style("display", "block")
                        .style("z-index", 1000)
                        .style("postion", "absolute")
                        .text(d.id + ": " + title + ": " + d.total);
                })
                .on("mouseout", function () {
                    d3.select("#tooltip").style("display", "none");
                });
        }

        drawChart(dataValues);
    </script>
</body>
