<!DOCTYPE html>
<head>
    <meta charset="utf-8" />

    <!-- Load d3.js -->
    <script src="./Data/d3.v4.min.js"></script>
    <title>Chord Diagram</title>
    <link rel="icon" href="logo.png" type="image/png" sizes="32x32" />
    <link rel="stylesheet" href="Data/general.css" />
</head>
<body>
    <div style="text-align: center">
        <!-- Create a div where the graph will take place -->
        <div id="my_dataviz"></div>
    </div>
    <div id="tooltip"></div>

    <script>
        // Color Pallets - Set 3
        const d3colors = [
            "#8DD3C9",
            "#FFFFAA",
            "#B8BED6",
            "#F98171",
            "#78B5D1",
            "#FFB15B",
            "#B4E061",
            "#FDCDE5",
            "#DAD9D4",
            "#BD7FBE",
            "#CDE9C1",
            "#FFEA77",
        ];

        const width = 600;
        const height = 600;

        // create the svg area
        var svg = d3
            .select("#my_dataviz")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(220,220)");

        // create a matrix
        var matrix = [
            [0, 5871, 8916, 2868],
            [1951, 0, 2060, 6171],
            [8010, 16145, 0, 8045],
            [1013, 990, 940, 0],
        ];

        // 4 groups, so create a vector of 4 colors
        var colors = d3colors;

        // give this matrix to d3.chord(): it will calculates all the info we need to draw arc and ribbon
        var res = d3.chord().padAngle(0.05).sortSubgroups(d3.descending)(
            matrix
        );

        // add the groups on the outer part of the circle
        svg.datum(res)
            .append("g")
            .selectAll("g")
            .data(function (d) {
                return d.groups;
            })
            .enter()
            .append("g")
            .append("path")
            .style("fill", function (d, i) {
                return colors[i];
            })
            .style("stroke", "grey")
            .attr("d", d3.arc().innerRadius(200).outerRadius(210));

        // Add the links between groups
        svg.datum(res)
            .append("g")
            .selectAll("path")
            .data(function (d) {
                return d;
            })
            .enter()
            .append("path")
            .attr("d", d3.ribbon().radius(200))
            .style("fill", function (d) {
                return colors[d.source.index];
            }) // colors depend on the source group. Change to target otherwise.
            .style("stroke", "gray")
            .attr("class", function (d, i) {
                return "condegram";
            })
            .on("mouseover mousemove", function (d, i) {
                var x_pos = d3.mouse(this)[0] + width;
                var y_pos = d3.mouse(this)[1] + height / 2;

                d3.select("#tooltip")
                    .style("left", x_pos + "px")
                    .style("top", y_pos + "px")
                    .style("display", "block")
                    .style("z-index", 1000)
                    .style("postion", "absolute")
                    .html(
                        "Source: " +
                            d.source.value +
                            "<br/>Target:" +
                            d.target.value
                    );
                d3.selectAll(".condegram").style("opacity", 0.3);
                d3.select(this).style("opacity", 1);
            })
            .on("mouseout", function (d, i) {
                d3.select("#tooltip").style("display", "none");
                d3.selectAll(".condegram").style("opacity", 1);
            });
    </script>
</body>
