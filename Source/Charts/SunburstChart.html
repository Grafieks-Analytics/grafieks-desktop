<html>
    <head>
        <script src="./Data/d3.v4.min.js"></script>
        <script src="./Data/d3DefaultConfig.js"></script>
        <script src="Data/d3-scale-chromatic.v1.min.js"></script>
        <link rel="stylesheet" href="Data/general.css" />
        <script src="./Data/utils.js"></script>

        <title>Sunburst Chart</title>

        <style>
            body {
                font-family: Sans-serif;
            }

            .slice {
                cursor: pointer;
            }

            .slice .main-arc {
                stroke: #fff;
                stroke-width: 0px;
            }

            .slice .hidden-arc {
                fill: none;
            }

            .slice text {
                pointer-events: none;
                dominant-baseline: middle;
                text-anchor: middle;
            }
            #my_dataviz{
                height: 100vh;
            }
        </style>
    </head>
    <body>
        <div id="my_dataviz"></div>
        <div id="tooltip"></div>
        <div id="legend"></div>
        <script>
            // Color Pallets - Set 3
            const d3colors = [
                "#8DD3C9",
                "#FFFFAA",
                "#B8BED6",
                "#F98171",
                "#78B5D1",
                "#FFB15B",
                "#B4E061",
                "#FDCDE5",
                "#DAD9D4",
                "#BD7FBE",
                "#CDE9C1",
                "#FFEA77",
            ];

            var data = {
                name: "flare",
                children: [
                    {
                        name: "analytics",
                        children: [
                            {
                                name: "cluster",
                                children: [
                                    {
                                        name: "AgglomerativeCluster",
                                        size: 3938,
                                    },
                                    {
                                        name: "CommunityStructure",
                                        size: 3812,
                                    },
                                    {
                                        name: "HierarchicalCluster",
                                        size: 6714,
                                    },
                                    { name: "MergeEdge", size: 743 },
                                ],
                            },
                            {
                                name: "graph",
                                children: [
                                    {
                                        name: "BetweennessCentrality",
                                        size: 3534,
                                    },
                                    { name: "LinkDistance", size: 5731 },
                                    { name: "MaxFlowMinCut", size: 7840 },
                                    { name: "ShortestPaths", size: 5914 },
                                    { name: "SpanningTree", size: 3416 },
                                ],
                            },
                            {
                                name: "optimization",
                                children: [
                                    {
                                        name: "AspectRatioBanker",
                                        size: 7074,
                                    },
                                ],
                            },
                        ],
                    },
                    {
                        name: "animate",
                        label: "animate",
                        children: [
                            { name: "Easing", size: 17010 },
                            { name: "FunctionSequence", size: 5842 },
                            {
                                name: "interpolate",
                                children: [
                                    {
                                        name: "ArrayInterpolator",
                                        size: 1983,
                                    },
                                    {
                                        name: "ColorInterpolator",
                                        size: 2047,
                                    },
                                    {
                                        name: "DateInterpolator",
                                        size: 1375,
                                    },
                                    { name: "Interpolator", size: 8746 },
                                    {
                                        name: "MatrixInterpolator",
                                        size: 2202,
                                    },
                                    {
                                        name: "NumberInterpolator",
                                        size: 1382,
                                    },
                                    {
                                        name: "ObjectInterpolator",
                                        size: 1629,
                                    },
                                    {
                                        name: "PointInterpolator",
                                        size: 1675,
                                    },
                                    {
                                        name: "RectangleInterpolator",
                                        size: 2042,
                                    },
                                ],
                            },
                            { name: "ISchedulable", size: 1041 },
                            { name: "Parallel", size: 5176 },
                            { name: "Pause", size: 449 },
                            { name: "Scheduler", size: 5593 },
                            { name: "Sequence", size: 5534 },
                            { name: "Transition", size: 9201 },
                            { name: "Transitioner", size: 19975 },
                            { name: "TransitionEvent", size: 1116 },
                            { name: "Tween", size: 6006 },
                        ],
                    },
                    {
                        name: "data",
                        children: [
                            {
                                name: "converters",
                                children: [
                                    { name: "Converters", size: 721 },
                                    {
                                        name: "DelimitedTextConverter",
                                        size: 4294,
                                    },
                                    {
                                        name: "GraphMLConverter",
                                        size: 9800,
                                    },
                                    { name: "IDataConverter", size: 1314 },
                                    { name: "JSONConverter", size: 2220 },
                                ],
                            },
                            { name: "DataField", size: 1759 },
                            { name: "DataSchema", size: 2165 },
                            { name: "DataSet", size: 586 },
                            { name: "DataSource", size: 3331 },
                            { name: "DataTable", size: 772 },
                            { name: "DataUtil", size: 3322 },
                        ],
                    },
                    {
                        name: "display",
                        children: [
                            { name: "DirtySprite", size: 8833 },
                            { name: "LineSprite", size: 1732 },
                            { name: "RectSprite", size: 3623 },
                            { name: "TextSprite", size: 10066 },
                        ],
                    },
                    {
                        name: "flex",
                        children: [{ name: "FlareVis", size: 4116 }],
                    },
                    {
                        name: "physics",
                        children: [
                            { name: "DragForce", size: 1082 },
                            { name: "GravityForce", size: 1336 },
                            { name: "IForce", size: 319 },
                            { name: "NBodyForce", size: 10498 },
                            { name: "Particle", size: 2822 },
                            { name: "Simulation", size: 9983 },
                            { name: "Spring", size: 2213 },
                            { name: "SpringForce", size: 1681 },
                        ],
                    },
                    {
                        name: "query",
                        children: [
                            { name: "AggregateExpression", size: 1616 },
                            { name: "And", size: 1027 },
                            { name: "Arithmetic", size: 3891 },
                            { name: "Average", size: 891 },
                            { name: "BinaryExpression", size: 2893 },
                            { name: "Comparison", size: 5103 },
                            { name: "CompositeExpression", size: 3677 },
                            { name: "Count", size: 781 },
                            { name: "DateUtil", size: 4141 },
                            { name: "Distinct", size: 933 },
                            { name: "Expression", size: 5130 },
                            { name: "ExpressionIterator", size: 3617 },
                            { name: "Fn", size: 3240 },
                            { name: "If", size: 2732 },
                            { name: "IsA", size: 2039 },
                            { name: "Literal", size: 1214 },
                            { name: "Match", size: 3748 },
                            { name: "Maximum", size: 843 },
                            {
                                name: "methods",
                                children: [
                                    { name: "add", size: 593 },
                                    { name: "and", size: 330 },
                                    { name: "average", size: 287 },
                                    { name: "count", size: 277 },
                                    { name: "distinct", size: 292 },
                                    { name: "div", size: 595 },
                                    { name: "eq", size: 594 },
                                    { name: "fn", size: 460 },
                                    { name: "gt", size: 603 },
                                    { name: "gte", size: 625 },
                                    { name: "iff", size: 748 },
                                    { name: "isa", size: 461 },
                                    { name: "lt", size: 597 },
                                    { name: "lte", size: 619 },
                                    { name: "max", size: 283 },
                                    { name: "min", size: 283 },
                                    { name: "mod", size: 591 },
                                    { name: "mul", size: 603 },
                                    { name: "neq", size: 599 },
                                    { name: "not", size: 386 },
                                    { name: "or", size: 323 },
                                    { name: "orderby", size: 307 },
                                    { name: "range", size: 772 },
                                    { name: "select", size: 296 },
                                    { name: "stddev", size: 363 },
                                    { name: "sub", size: 600 },
                                    { name: "sum", size: 280 },
                                    { name: "update", size: 307 },
                                    { name: "variance", size: 335 },
                                    { name: "where", size: 299 },
                                    { name: "xor", size: 354 },
                                    { name: "_", size: 264 },
                                ],
                            },
                            { name: "Minimum", size: 843 },
                            { name: "Not", size: 1554 },
                            { name: "Or", size: 970 },
                            { name: "Query", size: 13896 },
                            { name: "Range", size: 1594 },
                            { name: "StringUtil", size: 4130 },
                            { name: "Sum", size: 791 },
                            { name: "Variable", size: 1124 },
                            { name: "Variance", size: 1876 },
                            { name: "Xor", size: 1101 },
                        ],
                    },
                    {
                        name: "scale",
                        children: [
                            { name: "IScaleMap", size: 2105 },
                            { name: "LinearScale", size: 1316 },
                            { name: "LogScale", size: 3151 },
                            { name: "OrdinalScale", size: 3770 },
                            { name: "QuantileScale", size: 2435 },
                            { name: "QuantitativeScale", size: 4839 },
                            { name: "RootScale", size: 1756 },
                            { name: "Scale", size: 4268 },
                            { name: "ScaleType", size: 1821 },
                            { name: "TimeScale", size: 5833 },
                        ],
                    },
                    {
                        name: "util",
                        children: [
                            { name: "Arrays", size: 8258 },
                            { name: "Colors", size: 10001 },
                            { name: "Dates", size: 8217 },
                            { name: "Displays", size: 12555 },
                            { name: "Filter", size: 2324 },
                            { name: "Geometry", size: 10993 },
                            {
                                name: "heap",
                                children: [
                                    { name: "FibonacciHeap", size: 9354 },
                                    { name: "HeapNode", size: 1233 },
                                ],
                            },
                            { name: "IEvaluable", size: 335 },
                            { name: "IPredicate", size: 383 },
                            { name: "IValueProxy", size: 874 },
                            {
                                name: "math",
                                children: [
                                    { name: "DenseMatrix", size: 3165 },
                                    { name: "IMatrix", size: 2815 },
                                    { name: "SparseMatrix", size: 3366 },
                                ],
                            },
                            { name: "Maths", size: 17705 },
                            { name: "Orientation", size: 1486 },
                            {
                                name: "palette",
                                children: [
                                    { name: "ColorPalette", size: 6367 },
                                    { name: "Palette", size: 1229 },
                                    { name: "ShapePalette", size: 2059 },
                                    { name: "SizePalette", size: 2291 },
                                ],
                            },
                            { name: "Property", size: 5559 },
                            { name: "Shapes", size: 19118 },
                            { name: "Sort", size: 6887 },
                            { name: "Stats", size: 6557 },
                            { name: "Strings", size: 22026 },
                        ],
                    },
                    {
                        name: "vis",
                        children: [
                            {
                                name: "axis",
                                children: [
                                    { name: "Axes", size: 1302 },
                                    { name: "Axis", size: 24593 },
                                    { name: "AxisGridLine", size: 652 },
                                    { name: "AxisLabel", size: 636 },
                                    { name: "CartesianAxes", size: 6703 },
                                ],
                            },
                            {
                                name: "controls",
                                children: [
                                    { name: "AnchorControl", size: 2138 },
                                    { name: "ClickControl", size: 3824 },
                                    { name: "Control", size: 1353 },
                                    { name: "ControlList", size: 4665 },
                                    { name: "DragControl", size: 2649 },
                                    { name: "ExpandControl", size: 2832 },
                                    { name: "HoverControl", size: 4896 },
                                    { name: "IControl", size: 763 },
                                    { name: "PanZoomControl", size: 5222 },
                                    {
                                        name: "SelectionControl",
                                        size: 7862,
                                    },
                                    { name: "TooltipControl", size: 8435 },
                                ],
                            },
                            {
                                name: "data",
                                children: [
                                    { name: "Data", size: 20544 },
                                    { name: "DataList", size: 19788 },
                                    { name: "DataSprite", size: 10349 },
                                    { name: "EdgeSprite", size: 3301 },
                                    { name: "NodeSprite", size: 19382 },
                                    {
                                        name: "render",
                                        children: [
                                            {
                                                name: "ArrowType",
                                                size: 698,
                                            },
                                            {
                                                name: "EdgeRenderer",
                                                size: 5569,
                                            },
                                            {
                                                name: "IRenderer",
                                                size: 353,
                                            },
                                            {
                                                name: "ShapeRenderer",
                                                size: 2247,
                                            },
                                        ],
                                    },
                                    { name: "ScaleBinding", size: 11275 },
                                    { name: "Tree", size: 7147 },
                                    { name: "TreeBuilder", size: 9930 },
                                ],
                            },
                            {
                                name: "events",
                                children: [
                                    { name: "DataEvent", size: 2313 },
                                    { name: "SelectionEvent", size: 1880 },
                                    { name: "TooltipEvent", size: 1701 },
                                    {
                                        name: "VisualizationEvent",
                                        size: 1117,
                                    },
                                ],
                            },
                            {
                                name: "legend",
                                children: [
                                    { name: "Legend", size: 20859 },
                                    { name: "LegendItem", size: 4614 },
                                    { name: "LegendRange", size: 10530 },
                                ],
                            },
                            {
                                name: "operator",
                                children: [
                                    {
                                        name: "distortion",
                                        children: [
                                            {
                                                name: "BifocalDistortion",
                                                size: 4461,
                                            },
                                            {
                                                name: "Distortion",
                                                size: 6314,
                                            },
                                            {
                                                name: "FisheyeDistortion",
                                                size: 3444,
                                            },
                                        ],
                                    },
                                    {
                                        name: "encoder",
                                        children: [
                                            {
                                                name: "ColorEncoder",
                                                size: 3179,
                                            },
                                            { name: "Encoder", size: 4060 },
                                            {
                                                name: "PropertyEncoder",
                                                size: 4138,
                                            },
                                            {
                                                name: "ShapeEncoder",
                                                size: 1690,
                                            },
                                            {
                                                name: "SizeEncoder",
                                                size: 1830,
                                            },
                                        ],
                                    },
                                    {
                                        name: "filter",
                                        children: [
                                            {
                                                name: "FisheyeTreeFilter",
                                                size: 5219,
                                            },
                                            {
                                                name: "GraphDistanceFilter",
                                                size: 3165,
                                            },
                                            {
                                                name: "VisibilityFilter",
                                                size: 3509,
                                            },
                                        ],
                                    },
                                    { name: "IOperator", size: 1286 },
                                    {
                                        name: "label",
                                        children: [
                                            { name: "Labeler", size: 9956 },
                                            {
                                                name: "RadialLabeler",
                                                size: 3899,
                                            },
                                            {
                                                name: "StackedAreaLabeler",
                                                size: 3202,
                                            },
                                        ],
                                    },
                                    {
                                        name: "layout",
                                        children: [
                                            {
                                                name: "AxisLayout",
                                                size: 6725,
                                            },
                                            {
                                                name: "BundledEdgeRouter",
                                                size: 3727,
                                            },
                                            {
                                                name: "CircleLayout",
                                                size: 9317,
                                            },
                                            {
                                                name: "CirclePackingLayout",
                                                size: 12003,
                                            },
                                            {
                                                name: "DendrogramLayout",
                                                size: 4853,
                                            },
                                            {
                                                name: "ForceDirectedLayout",
                                                size: 8411,
                                            },
                                            {
                                                name: "IcicleTreeLayout",
                                                size: 4864,
                                            },
                                            {
                                                name: "IndentedTreeLayout",
                                                size: 3174,
                                            },
                                            { name: "Layout", size: 7881 },
                                            {
                                                name: "NodeLinkTreeLayout",
                                                size: 12870,
                                            },
                                            {
                                                name: "PieLayout",
                                                size: 2728,
                                            },
                                            {
                                                name: "RadialTreeLayout",
                                                size: 12348,
                                            },
                                            {
                                                name: "RandomLayout",
                                                size: 870,
                                            },
                                            {
                                                name: "StackedAreaLayout",
                                                size: 9121,
                                            },
                                            {
                                                name: "TreeMapLayout",
                                                size: 9191,
                                            },
                                        ],
                                    },
                                    { name: "Operator", size: 2490 },
                                    { name: "OperatorList", size: 5248 },
                                    {
                                        name: "OperatorSequence",
                                        size: 4190,
                                    },
                                    { name: "OperatorSwitch", size: 2581 },
                                    { name: "SortOperator", size: 2023 },
                                ],
                            },
                            { name: "Visualization", size: 16540 },
                        ],
                    },
                ],
            };

            var data = [{
                name: "Category",
                children: [
                    {
                        children: [
                            {
                                children: [
                                    {
                                        children: [],
                                        name: "Consumer",
                                        size: 6952,
                                    },
                                    {
                                        children: [],
                                        name: "Home Office",
                                        size: 1064,
                                    },
                                ],
                                name: "Bookcases",
                                size: 8016,
                            },
                            {
                                children: [
                                    {
                                        children: [],
                                        name: "Consumer",
                                        size: 4692,
                                    },
                                    {
                                        children: [],
                                        name: "Home Office",
                                        size: 2214,
                                    },
                                ],
                                name: "Chairs",
                                size: 6906,
                            },
                            {
                                children: [
                                    {
                                        children: [],
                                        name: "Consumer",
                                        size: 10230,
                                    },
                                ],
                                name: "Tables",
                                size: 10230,
                            },
                            {
                                children: [
                                    {
                                        children: [],
                                        name: "Consumer",
                                        size: 1240,
                                    },
                                    {
                                        children: [],
                                        name: "Corporate",
                                        size: 486,
                                    },
                                    {
                                        children: [],
                                        name: "Home Office",
                                        size: 672,
                                    },
                                ],
                                name: "Furnishings",
                                size: 2398,
                            },
                        ],
                        name: "Furniture",
                        size: 27550,
                    },
                    {
                        children: [
                            {
                                children: [
                                    {
                                        children: [],
                                        name: "Corporate",
                                        size: 30,
                                    },
                                    {
                                        children: [],
                                        name: "Consumer",
                                        size: 162,
                                    },
                                ],
                                name: "Labels",
                                size: 192,
                            },
                            {
                                children: [
                                    {
                                        children: [],
                                        name: "Consumer",
                                        size: 3460,
                                    },
                                    {
                                        children: [],
                                        name: "Corporate",
                                        size: 402,
                                    },
                                    {
                                        children: [],
                                        name: "Home Office",
                                        size: 776,
                                    },
                                ],
                                name: "Storage",
                                size: 4638,
                            },
                            {
                                children: [
                                    {
                                        children: [],
                                        name: "Consumer",
                                        size: 452,
                                    },
                                    {
                                        children: [],
                                        name: "Corporate",
                                        size: 2304,
                                    },
                                ],
                                name: "Art",
                                size: 2756,
                            },
                            {
                                children: [
                                    {
                                        children: [],
                                        name: "Consumer",
                                        size: 1706,
                                    },
                                    {
                                        children: [],
                                        name: "Home Office",
                                        size: 22,
                                    },
                                    {
                                        children: [],
                                        name: "Corporate",
                                        size: 386,
                                    },
                                ],
                                name: "Binders",
                                size: 2114,
                            },
                            {
                                children: [
                                    {
                                        children: [],
                                        name: "Consumer",
                                        size: 230,
                                    },
                                    {
                                        children: [],
                                        name: "Home Office",
                                        size: 138,
                                    },
                                    {
                                        children: [],
                                        name: "Corporate",
                                        size: 692,
                                    },
                                ],
                                name: "Appliances",
                                size: 1060,
                            },
                            {
                                children: [
                                    {
                                        children: [],
                                        name: "Consumer",
                                        size: 842,
                                    },
                                    {
                                        children: [],
                                        name: "Home Office",
                                        size: 188,
                                    },
                                    {
                                        children: [],
                                        name: "Corporate",
                                        size: 168,
                                    },
                                ],
                                name: "Paper",
                                size: 1198,
                            },
                            {
                                children: [
                                    {
                                        children: [],
                                        name: "Consumer",
                                        size: 506,
                                    },
                                    {
                                        children: [],
                                        name: "Home Office",
                                        size: 226,
                                    },
                                    {
                                        children: [],
                                        name: "Corporate",
                                        size: 402,
                                    },
                                ],
                                name: "Envelopes",
                                size: 1134,
                            },
                            {
                                children: [
                                    {
                                        children: [],
                                        name: "Corporate",
                                        size: 72,
                                    },
                                    {
                                        children: [],
                                        name: "Consumer",
                                        size: 88,
                                    },
                                ],
                                name: "Fasteners",
                                size: 160,
                            },
                            {
                                children: [
                                    {
                                        children: [],
                                        name: "Consumer",
                                        size: 132,
                                    },
                                ],
                                name: "Supplies",
                                size: 132,
                            },
                        ],
                        name: "Office Supplies",
                        size: 13384,
                    },
                    {
                        children: [
                            {
                                children: [
                                    {
                                        children: [],
                                        name: "Consumer",
                                        size: 2476,
                                    },
                                    {
                                        children: [],
                                        name: "Corporate",
                                        size: 5154,
                                    },
                                    {
                                        children: [],
                                        name: "Home Office",
                                        size: 742,
                                    },
                                ],
                                name: "Phones",
                                size: 8372,
                            },
                            {
                                children: [
                                    {
                                        children: [],
                                        name: "Corporate",
                                        size: 92,
                                    },
                                    {
                                        children: [],
                                        name: "Consumer",
                                        size: 654,
                                    },
                                    {
                                        children: [],
                                        name: "Home Office",
                                        size: 192,
                                    },
                                ],
                                name: "Accessories",
                                size: 938,
                            },
                        ],
                        name: "Technology",
                        size: 9310,
                    },
                ],
            }];

            function drawChart(data, plottingConfiguration = {}) {
                window.data = data;
                data = data[0]
                // data = { name: "", children: data };
                let {
                    d3colorPalette,
                    paddingInner,
                    markerShape,
                    curveType,
                    labelConfig = defaultD3Config.defaultlabelConfig,
                    legendConfig = defaultD3Config.defaultLegendConfig,
                    dataLabelfontSize = defaultD3Config.fontSize,
                    dataLabelfontFamily = defaultD3Config.fontFamily,
                } = plottingConfiguration;
                window.dataLabelfontSize = dataLabelfontSize;
                window.dataLabelfontFamily = dataLabelfontFamily;
                if (!d3colorPalette) {
                    d3colorPalette = defaultD3Config.d3ColorPalette;
                }

                 let { legendStatus, legendPosition } = legendConfig;
                d3Colors = d3colorPalette;
                let { labelStatus } = labelConfig;
                if (!paddingInner) {
                    paddingInner = defaultD3Config.defaultPaddingInner;
                }



                 // legends code starts
                d3.select("#legend").html("").style("padding", "");
                if (legendStatus) {
                    d3.select("#legend").html("");

                    d3.select("#legend")
                        .append("p")
                        .html("xAxisLabel" + "&nbsp;")
                        .style("font-weight", "bold")
                        .style("margin", "auto")
                        .style("position", "sticky");

                    d3.select("#legend")
                        .selectAll("div")
                        .data("[data[1][0]]")
                        .enter()
                        .append("div")
                        .html((d, i) => {
                            return (
                                '<div style="width: 15px; height: 15px; margin-top:2px; background: ' +
                                d3Colors[i % d3Colors.length] +
                                ';">  </div>' +
                                "<span style='margin-left: 5px; max-width: 160px'>" +
                                d +
                                "</span>"
                            );
                        })
                        .style("display", "flex")
                        .style("padding", "2px");
                }

                // legends code ends

                // legends height ,width elements
                var legendElement = document.querySelector("#legend");
                var legendHeight = legendElement.offsetHeight;
                var legendWidth = legendElement.offsetWidth;

                // const yAxisWidth =
                //     document.querySelector("#yAxisDiv").clientWidth;

                d3.select("#legend").attr("style", null);
                d3.select("#mainChartWindow").attr("style", null);
                d3.select("#xAxisLabelId").style("bottom", 20);

                // legends code starts
                if (legendStatus) {
                    if (
                        legendHeight <
                        document.querySelector("html").offsetHeight
                    ) {
                        topPosition = "calc(50vh - " + legendHeight / 2 + "px)";
                    } else {
                        topPosition = 0;
                    }
                    rightPosition = "calc(50vw - " + legendWidth / 2 + "px)";

                    //  var widthOld = (document.querySelector("#my_dataviz").clientWidth) ;
                    var widthOld =
                        document.querySelector("html").clientWidth - 72;
                    var heightOld = document.querySelector("html").clientHeight;

                    // legendElement.style.padding = "10px";
                    legendElement.style.border = "1px solid black";
                    d3.selectAll("#my_dataviz").style("margin-top", 0 + "px");

                    switch (legendPosition) {
                        case "left":
                            d3.select("#legend")
                                .attr("style", null)
                                .style("top", topPosition)
                                .style("right", "auto")
                                // .style("bottom", "auto")
                                .style("left", "0px")
                                // .style("right", "5px")
                                .style("display", "block")
                                .style("max-height", "100vh")
                                .style("overflow", "scroll")
                                .style("border", "none")
                                .style("position", "fixed");
                            d3.selectAll("#legend div span")
                                .style("max-width", "160px")
                                .style("white-space", "nowrap")
                                .style("overflow", "hidden")
                                .style("text-overflow", "ellipsis");

                            var legendWidth = legendElement.offsetWidth;
                            // margin.left += 100;
                            // width -= 100;
                            // d3.select("#my_dataviz svg").attr("width", width + margin.left + margin.right);

                            d3.select("#mainChartWindow").attr("style", null);

                            // d3.select("#mainChartWindow").style(
                            //     "width",
                            //     widthOld - legendWidth + yAxisWidth
                            // );
                            d3.select("#mainChartWindow").style(
                                "margin-left",
                                legendWidth + "px"
                            );
                            d3.select("#xAxisLabelId").style(
                                "bottom",
                                10 + "px"
                            );
                            d3.selectAll("#my_dataviz").style(
                                "height",
                                "calc(100vh)"
                            );

                            break;
                        case "top":
                            d3.select("#mainChartWindow").attr("style", null);
                            // margin.top += 50;
                            // height -= 50;
                            y_pos_x_label = 57;
                            d3.select("#legend")
                                .attr("style", null)
                                .style("top", "10px")
                                .style("right", rightPosition)
                                .style("bottom", "auto")
                                .style("left", "auto")
                                .style("display", "flex")
                                .style("max-width", "99vw")
                                .style("overflow", "scroll")
                                .style("border", "none");
                            d3.selectAll("#legend div span")
                                .style("max-width", "160px")
                                .style("white-space", "nowrap")
                                .style("overflow", "hidden")
                                .style("text-overflow", "ellipsis");
                            d3.select("#xAxisLabelId").style(
                                "bottom",
                                10 + "px"
                            );
                            d3.selectAll("#my_dataviz").style(
                                "height",
                                "calc(100vh - 72px) "
                            );
                            d3.selectAll("#my_dataviz").style(
                                "margin-top",
                                50 + "px"
                            );

                            // d3.selectAll("#legend div").style(
                            //     "padding",
                            //     "2px 4px"
                            // );
                            break;
                        case "bottom":
                            // height -= 50; // use legend client height
                            // margin.bottom += 10;
                            var legendWidth = legendElement.offsetWidth;
                            y_pos_x_label = 20;

                            d3.select("#xAxisLabelId").style("bottom", "60px");
                            d3.select("#mainChartWindow").attr("style", null);

                            // d3.select("#mainChartWindow").style("width", width);
                            //  d3.select("#mainChartWindow").style("height",heightOld-80 );
                            d3.select("#mainChartWindow").style(
                                "margin-left",
                                0
                            );
                            d3.select("#legend")
                                .attr("style", null)
                                .style("top", "auto")
                                .style("right", rightPosition)
                                .style("bottom", "0px")
                                // .style("left", margin.left + "px")
                                .style("display", "flex")
                                .style("max-width", "99vw")
                                .style("overflow", "scroll")
                                .style("border", "none");

                            d3.selectAll("#legend div span")
                                .style("max-width", "160px")
                                .style("white-space", "nowrap")
                                .style("overflow", "hidden")
                                .style("text-overflow", "ellipsis");
                            d3.selectAll("#my_dataviz").style(
                                "height",
                                "calc(100vh - 42px)"
                            );

                            break;
                        // For Right Legened
                        case "right":
                        default:
                            // width -= 220;
                            // d3.select("#my_dataviz").style("width", width + margin.left + margin.right);
                            var legendWidth = legendElement.offsetWidth;

                            d3.select("#legend")
                                .attr("style", null)
                                .style("right", "0px")
                                .style("left", "auto")
                                .style("position", "fixed")
                                .style("top", topPosition)
                                .style("max-height", "100vh")
                                .style("overflow", "scroll")
                                .style("border", "none")
                                .style("bottom", "auto")
                                .style("display", "block");
                            d3.selectAll("#legend div span")
                                .style("max-width", "160px")
                                .style("white-space", "nowrap")
                                .style("overflow", "hidden")
                                .style("text-overflow", "ellipsis");

                            d3.select("#mainChartWindow").attr("style", null);
                            // d3.select("#mainChartWindow").style(
                            //     "width",
                            //     widthOld - legendWidth  - 10 + "px"
                            // );
                            d3.select("#mainChartWindow").style(
                                "margin-left",
                                0
                            );
                            d3.select("#xAxisLabelId").style(
                                "bottom",
                                10 + "px"
                            );
                            d3.selectAll("#my_dataviz").style(
                                "height",
                                "calc(100vh)"
                            );
                    }
                }

                // if (legendPosition == "left" || legendPosition == "right") {
                //     var legendWidth = legendElement.offsetWidth;
                //     width -= legendWidth;
                // }

                // legends code ends

                d3.selectAll("#my_dataviz").html("");
                (margin = { top: 30, right: 30, bottom: 70, left: 60 }),
                    (width =
                        window.innerWidth - margin.left - margin.right - 20),
                    (height =
                        window.innerHeight - margin.top - margin.bottom - 30);

                maxRadius = Math.min(width, height) / 2;

                const formatNumber = d3.format(",d");

                const x = d3
                    .scaleLinear()
                    .range([0, 2 * Math.PI])
                    .clamp(true);

                const y = d3.scaleSqrt().range([maxRadius * 0.1, maxRadius]);

                const color = d3.scaleOrdinal(d3Colors);

                const partition = d3.partition();

                const arc = d3
                    .arc()
                    .startAngle((d) => x(d.x0))
                    .endAngle((d) => x(d.x1))
                    .innerRadius((d) => Math.max(0, y(d.y0)))
                    .outerRadius((d) => Math.max(0, y(d.y1)));

                const middleArcLine = (d) => {
                    const halfPi = Math.PI / 2;
                    const angles = [x(d.x0) - halfPi, x(d.x1) - halfPi];
                    const r = Math.max(0, (y(d.y0) + y(d.y1)) / 2);

                    const middleAngle = (angles[1] + angles[0]) / 2;
                    const invertDirection =
                        middleAngle > 0 && middleAngle < Math.PI; // On lower quadrants write text ccw
                    if (invertDirection) {
                        angles.reverse();
                    }

                    const path = d3.path();
                    path.arc(0, 0, r, angles[0], angles[1], invertDirection);
                    return path.toString();
                };

                const textFits = (d) => {
                    const CHAR_SPACE = 6;

                    const deltaAngle = x(d.x1) - x(d.x0);
                    const r = Math.max(0, (y(d.y0) + y(d.y1)) / 2);
                    const perimeter = r * deltaAngle;

                    return d.data.name.length * CHAR_SPACE < perimeter;
                };

                const svg = d3
                    .select("#my_dataviz")
                    .append("svg")
                    .attr(
                        "viewBox",
                        `${-width / 2} ${-(height / 2) - 35} ${width} ${
                            height + 40
                        }`
                    )
                    .on("click", () => focusOn()); // Reset zoom on canvas click

                data = d3.hierarchy(data);
                data.sum((d) => d.size);

                const slice = svg
                    .selectAll("g.slice")
                    .data(partition(data).descendants());

                slice.exit().remove();

                const newSlice = slice
                    .enter()
                    .append("g")
                    .attr("class", "slice")
                    .on("click", (d) => {
                        d3.event.stopPropagation();
                        focusOn(d);
                    });

                newSlice
                    .append("path")
                    .attr("class", "main-arc")
                    .style("fill", (d) =>
                        color((d.children ? d : d.parent).data.name)
                    )
                    .attr("d", arc)
                    .on("mouseover mousemove", function (d, i) {
                        var x_pos = d3.mouse(this)[0] + width / 2 + 70;
                        var y_pos = d3.mouse(this)[1] + height / 2 - 20;

                        d3.select("#tooltip")
                            .style("left", x_pos + "px")
                            .style("top", y_pos + "px")
                            .style("display", "block")
                            .style("z-index", 1000)
                            .style("postion", "absolute")
                            // .text(d.data.name + ":" + d.value);
                            .html(function () {
                                var textValue = d.y0 - d.y1;
                                if (d.y1 < 0) {
                                    textValue = d.y1 - d.y0;
                                }

                                return (
                                    "<div class='arrowTooltip'></div>" +
                                    "<span style='color:grey;''>" +
                                    "xAxisLabel" +
                                    ":&nbsp;&nbsp;" +
                                    "</span>" +
                                    "<span style='float: right;'>" +
                                    d.data.name +
                                    "</span>" +
                                    "<br/> <br/>" +
                                    "<span style='color:grey;''>" +
                                    "yAxisLabel" +
                                    ":" +
                                    "</span>" +
                                    "<span style='float: right;margin-left: 15px;'>" +
                                    d.value +
                                    "</span>"
                                );
                            });
                        d3.select(".arrowTooltip").attr(
                            "style",
                            "border: solid; border-color: white transparent; border-width: 12px 6px 0 6px; content: '';left: -12px; transform: rotate(90deg)!important;bottom: 22px; position: absolute;"
                        );

                        d3.select(this)
                            .style("fill", d3Colors[0])
                            .attr("stroke", "gray")
                            .attr("stroke-width", 1);
                    })
                    .on("mouseout", function (d, i) {
                        d3.select("#tooltip").style("display", "none");
                        d3.select(this)
                            .attr("stroke", "")
                            .attr("stroke-width", 0);
                        d3.select(this).style(
                            "fill",
                            color((d.children ? d : d.parent).data.name)
                        );
                    });

                newSlice
                    .append("path")
                    .attr("class", "hidden-arc")
                    .attr("id", (_, i) => `hiddenArc${i}`)
                    .attr("d", middleArcLine);

                const text = newSlice
                    .append("text")
                    .attr("display", (d) => (textFits(d) ? null : "none"));

                if (labelStatus) {
                    text.append("textPath")
                        .attr("startOffset", "50%")
                        .attr("xlink:href", (_, i) => `#hiddenArc${i}`)
                        .text((d) => d.data.name)
                        .attr("font-family", dataLabelfontFamily)
                        .attr("font-size", dataLabelfontSize);
                }

                function focusOn(d = { x0: 0, x1: 1, y0: 0, y1: 1 }) {
                    // Reset to top-level if no data point specified

                    const transition = svg
                        .transition()
                        .duration(750)
                        .tween("scale", () => {
                            const xd = d3.interpolate(x.domain(), [d.x0, d.x1]),
                                yd = d3.interpolate(y.domain(), [d.y0, 1]);
                            return (t) => {
                                x.domain(xd(t));
                                y.domain(yd(t));
                            };
                        });

                    transition
                        .selectAll("path.main-arc")
                        .attrTween("d", (d) => () => arc(d));

                    transition
                        .selectAll("path.hidden-arc")
                        .attrTween("d", (d) => () => middleArcLine(d));

                    transition
                        .selectAll("text")
                        .attrTween(
                            "display",
                            (d) => () => textFits(d) ? null : "none"
                        );

                    moveStackToFront(d);

                    //

                    function moveStackToFront(elD) {
                        svg.selectAll(".slice")
                            .filter((d) => d === elD)
                            .each(function (d) {
                                this.parentNode.appendChild(this);
                                if (d.parent) {
                                    moveStackToFront(d.parent);
                                }
                            });
                    }
                }
            }
            drawChart(data);

            // window.addEventListener("resize", function () {
            //     drawChart(data);
            // });
        </script>
    </body>
</html>
