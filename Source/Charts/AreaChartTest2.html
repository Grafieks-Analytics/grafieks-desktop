<!DOCTYPE html>
<head>
    <meta charset="utf-8" />

    <!-- Load d3.js -->
    <script src="./Data/d3DefaultConfig.js"></script>
    <script src="./Data/utils.js"></script>
    <script src="./Data/d3.v4.min.js"></script>
    <script src="./Data/d3-scale-chromatic.v1.min.js"></script>
    <link rel="stylesheet" href="Data/general.css" />

    <title>Area Chart</title>
    <style>
        .line {
            fill: none;
            stroke: #a2c0d9;
            stroke-width: 2px;
        }
        .area {
            fill: url(#area-gradient);
            stroke-width: 0px;
        }
    </style>
</head>
<body>
    <!-- Create a div where the graph will take place -->
    <div id="my_dataviz"></div>

    <script>
        var data = [
            [
                ["2012-04-30T18:30:00.000Z", 58.13],
                ["2012-04-29T18:30:00.000Z", 103.98],
            ],
            ["date", "close"],
            ["date", "close"],
        ];
        drawChart(data);
        function drawChart(data, plottingConfiguration = {}) {
            window.data = data;
            dataValues = data[0] || [];
            states = data[1] || [];
            keys = data[2] || [];

            let {
                d3colorPalette,
                paddingInner,
                markerShape,
                curveType,
                dateFormat,
                chartType,
                standartThresholdWidth,
            } = plottingConfiguration;

            if (!d3colorPalette) {
                d3colorPalette = defaultD3Config.d3ColorPalette;
            }
            d3Colors = d3colorPalette;

            if (!paddingInner) {
                paddingInner = defaultD3Config.defaultPaddingInner;
            }

            if (!dateFormat) {
                dateFormat = defaultD3Config.dateFormat;
            }

            if (!chartType) {
                chartType = defaultD3Config.chartType;
            }

            if (!standartThresholdWidth) {
                standartThresholdWidth = defaultD3Config.standartThresholdWidth;
            }

            var margin = { top: 40, right: 20, bottom: 80, left: 70 };
            var width = window.innerWidth - margin.left - margin.right - 70;
            if (chartType == constants.chartType.STANDARD) {
                width =
                    dataValues.length * keys.length * standartThresholdWidth;
            }

            var height = window.innerHeight - margin.top - margin.bottom;

            d3.selectAll("#my_dataviz").html("");

            // append the svg object to the body of the page
            var svg = d3
                .select("#my_dataviz")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr(
                    "transform",
                    "translate(" + margin.left + "," + margin.top + ")"
                );

            // Now I can use this dataset:
            // Add X axis --> it is a date format

            var x = d3
                .scaleBand()
                .domain(dataValues.map((d) => d[0]))
                .range([0, width]);
            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x));

            // Add Y axis
            var y = d3
                .scaleLinear()
                .domain([
                    0,
                    d3.max(dataValues, function (d) {
                        return d[1];
                    }),
                ])
                .range([height, 0]);
            svg.append("g").call(d3.axisLeft(y));

            // Add the area
            svg.append("path")
                .datum(dataValues)
                .attr("fill", "#cce5df")
                .attr("stroke", "#69b3a2")
                .attr("stroke-width", 1.5)
                .attr(
                    "d",
                    d3
                        .area()
                        .x(function (d) {
                            return x(d[0]);
                        })
                        .y0(y(0))
                        .y1(function (d) {
                            return y(d[1]);
                        })
                );
        }
    </script>
</body>
