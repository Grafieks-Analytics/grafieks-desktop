<!DOCTYPE html>
<head>
    <meta charset="utf-8" />

    <!-- Load d3.js -->
    <script src="./Data/d3DefaultConfig.js"></script>
    <script src="./Data/utils.js"></script>
    <script src="./Data/d3.v4.min.js"></script>
    <script src="./Data/d3-scale-chromatic.v1.min.js"></script>
    <link rel="icon" href="logo.png" type="image/png" sizes="32x32" />
    <link rel="stylesheet" href="Data/general.css" />

    <title>Area Chart</title>
</head>
<body>
    <div id="my_dataviz"></div>
    <div id="tooltip"></div>

    <!-- load the d3.js library -->
    <script>
        // Color Pallets - Set 3
        const d3colors = [
            "#8DD3C9",
            "#FFFFAA",
            "#B8BED6",
            "#F98171",
            "#78B5D1",
            "#FFB15B",
            "#B4E061",
            "#FDCDE5",
            "#DAD9D4",
            "#BD7FBE",
            "#CDE9C1",
            "#FFEA77",
        ];

        data = [
            [
                ["2012-04-30T18:30:00.000Z", 58.13],
                ["2012-04-29T18:30:00.000Z", 103.98],
            ],
            ["date", "close"],
        ];

        function drawChart(data, plottingConfiguration = {}) {
            window.data = data;
            let {
                d3colorPalette,
                paddingInner,
                legendConfig,
            } = plottingConfiguration;
            if (!d3colorPalette) {
                d3colorPalette = defaultD3Config.d3ColorPalette;
            }
            const d3Colors = d3colorPalette;
            if (!paddingInner) {
                paddingInner = defaultD3Config.defaultPaddingInner;
            }

            var margin = { top: 30, right: 30, bottom: 70, left: 60 },
                width = window.innerWidth - margin.left - margin.right - 20,
                height = window.innerHeight - margin.top - margin.bottom - 20;

            d3.selectAll("#my_dataviz").html("");

            // set the ranges
            var x = d3.scaleTime().range([0, width]);
            var y = d3.scaleLinear().range([height, 0]);

            // define the area
            var area = d3
                .area()
                .x(function (d) {
                    return x(d[0]);
                })
                .y0(height)
                .y1(function (d) {
                    return y(d[1]);
                });

            // define the line
            var valueline = d3
                .line()
                .x(function (d) {
                    return x(d[0]);
                })
                .y(function (d) {
                    return y(d[1]);
                });

            // append the svg obgect to the body of the page
            // appends a 'group' element to 'svg'
            // moves the 'group' element to the top left margin
            var svg = d3
                .select("#my_dataviz")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr(
                    "transform",
                    "translate(" + margin.left + "," + margin.top + ")"
                );

            // get the data

            // format the data

            dataValues = data[0];

            dataValues.forEach(function (d) {
                console.log(d);
                if (typeof d[0] == "string" && new Date(d[0]) != "Invalid Date")
                    d[0] = new Date(d[0]).getTime();
                d[1] = +d[1];
            });

            // scale the range of the data
            x.domain(
                d3.extent(dataValues, function (d) {
                    return d[0];
                })
            );
            y.domain([
                0,
                d3.max(dataValues, function (d) {
                    return d[1];
                }),
            ]);

            // add the X Axis
            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .attr("class", "x-axis")
                .call(d3.axisBottom(x).tickSizeOuter(0));

            // add the Y Axis
            svg.append("g")
                .attr("class", "y-axis")
                .call(d3.axisLeft(y).tickSizeOuter(0));

            svg.append("g")
                .attr("class", "grid")
                .style("stroke-width", "1")
                .call(make_y_gridlines().tickSize(-width).tickFormat(""));

            console.log(d3Colors);
            // add the area
            svg.append("path")
                .data([dataValues])
                .attr("fill", d3Colors[4])
                .attr("d", area)
                .on("mouseout", function (d, i) {
                    d3.select("#tooltip").style("display", "none");
                })
                .on("mouseover mousemove", function (d, i) {
                    let xpos = d3.mouse(this)[0] + margin.left;
                    let ypos = d3.mouse(this)[1];

                    d3.select("#tooltip")
                        .style("left", xpos + "px")
                        .style("top", ypos + "px")
                        .style("display", "block")
                        .text(Math.round(y.invert(ypos)));
                });

            // // add the valueline path.
            // svg.append("path")
            //     .data([dataValues])
            //     .attr("stroke", d3Colors[2])
            //     .attr("stroke-width", 2)
            //     .attr("fill", "none")
            //     .attr("d", valueline);

            // Generate Grid starts

            const [xAxisLabel, yAxisLabel] = data[1];

            setLabel(xAxisLabel, "x_label", false);
            setLabel(yAxisLabel, "y_label", false);

            function make_x_gridlines() {
                return d3.axisBottom(x).ticks(8);
            }
            function make_y_gridlines() {
                return d3.axisLeft(y).ticks(5);
            }
        }

        drawChart(data);

        // Generate Grid ends
    </script>
</body>
