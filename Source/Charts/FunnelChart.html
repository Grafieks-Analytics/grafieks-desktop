<html>
    <head>
        <style>
            body {
                font: 10px sans-serif;
            }
            .arc path {
                stroke: #fff;
            }
        </style>

        <script src="./Data/d3DefaultConfig.js"></script>
        <script src="./Data/utils.js"></script>
        <script src="./Data/d3.v4.min.js"></script>
        <script src="./Data/d3-scale-chromatic.v1.min.js"></script>
        <script src="./Data/d3-funnel.min.js"></script>
    </head>

    <body>
        <div id="my_dataviz" style="text-align: center"></div>
        <div id="tooltip"></div>

        <script>
            var data = [
                [
                    {
                        key: "Bookcases",
                        value: 8016,
                    },
                    {
                        key: "Chairs",
                        value: 6906,
                    },
                    {
                        key: "Labels",
                        value: 192,
                    },
                    {
                        key: "Tables",
                        value: 10230,
                    },
                    {
                        key: "Storage",
                        value: 4638,
                    },
                    {
                        key: "Furnishings",
                        value: 2398,
                    },
                    {
                        key: "Art",
                        value: 2756,
                    },
                    {
                        key: "Phones",
                        value: 8372,
                    },
                    {
                        key: "Binders",
                        value: 2114,
                    },
                    {
                        key: "Appliances",
                        value: 1060,
                    },
                    {
                        key: "Paper",
                        value: 1198,
                    },
                    {
                        key: "Envelopes",
                        value: 1134,
                    },
                    {
                        key: "Accessories",
                        value: 938,
                    },
                    {
                        key: "Fasteners",
                        value: 160,
                    },
                    {
                        key: "Supplies",
                        value: 132,
                    },
                ],
                ["Sub_Category", "Sales"],
            ];

            function drawChart(data, plottingConfiguration = {}) {
                window.data = data;

                var [data, label] = data;

                data = sortArraysOfObjectByValue(data, "value");
                data.forEach((d) => {
                    d.label = d.label || d.key;
                });

                let { d3colorPalette = defaultD3Config.d3ColorPalette } =
                    plottingConfiguration;

                // documentation for options
                // https://github.com/jakezatecky/d3-funnel/blob/master/README.md

                var colorValues =
                    parseInt(data.length / d3colorPalette.length) + 1;

                for (var i = 0; i < colorValues; i++) {
                    d3colorPalette.push(...d3colorPalette);
                }

                const options = {
                    block: {
                        dynamicHeight: false,
                        minHeight: 15,
                        fill: {
                            scale: d3colorPalette,
                        },
                    },
                    chart: {
                        bottomPinch: 0,
                        curve: {
                            enabled: false,
                        },
                        width: window.innerWidth / 2,
                        height: window.innerHeight - 50,
                    },
                    tooltip: {
                        enabled: true
                    }
                    
                };

                const chart = new D3Funnel("#my_dataviz");
                chart.draw(data, options);
            }

            drawChart(data);
        </script>
    </body>
</html>
